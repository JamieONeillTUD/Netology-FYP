<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Netology – Course</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="css/style.css">
</head>

<body class="net-bg">

  <!-- Topbar -->
  <header class="net-topbar" role="banner">
    <div class="container d-flex align-items-center justify-content-between gap-3">
      <div class="d-flex align-items-center gap-3">
        <div class="net-logo" aria-hidden="true"></div>
        <div>
          <div class="net-brand">Netology</div>
          <div class="net-subtitle small">Course learning path</div>
        </div>
      </div>

      <div class="d-flex align-items-center gap-2">
        <a href="dashboard.html" class="btn btn-outline-secondary btn-sm">Dashboard</a>
        <a href="sandbox.html" class="btn btn-teal btn-sm">Open Sandbox</a>
      </div>
    </div>
  </header>

  <main class="container my-4 net-course-shell" role="main" aria-label="Course page">
    <div class="net-course-layout">

      <!-- LEFT SIDEBAR -->
      <aside role="navigation" aria-label="Course units and lessons">
        <div class="net-sidebar p-3 p-lg-4">

          <div class="d-flex align-items-start gap-3 mb-3">
            <div class="net-course-badge" aria-hidden="true"></div>
            <div>
              <div class="small text-muted">Course</div>
              <div id="courseTitle" class="h6 mb-0 text-teal">Loading...</div>
              <div class="small text-muted mt-1">Units, lessons & progress</div>
            </div>
          </div>

          <!-- Progress -->
          <div class="mb-3" aria-label="Course progress">
            <div class="d-flex justify-content-between align-items-center small mb-1">
              <span class="text-muted">Progress</span>
              <span id="progressText" class="fw-semibold">0%</span>
            </div>
            <div class="progress" style="height: 10px;">
              <div id="progressBar" class="progress-bar bg-teal" style="width:0%"></div>
            </div>
            <div class="small text-muted mt-2">
              Tip: open a unit dropdown to jump to lessons quickly.
            </div>
          </div>

          <!-- Lessons list -->
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="fw-semibold">Units & Lessons</div>
            <span class="small text-muted" aria-hidden="true">▼</span>
          </div>

          <div id="lessonsList" class="net-lessons-scroll" aria-label="Lessons list">
            <p class="text-muted small mb-0">Loading lessons...</p>
          </div>

          <hr class="my-3">

          <div class="d-grid gap-2">
            <a href="sandbox.html" class="btn btn-outline-secondary btn-sm">Practice in Sandbox</a>
            <a href="dashboard.html" class="btn btn-outline-secondary btn-sm">Back to Dashboard</a>
          </div>

        </div>
      </aside>

      <!-- MAIN CONTENT -->
      <section class="net-lesson-panel" aria-label="Course content panel">

        <!-- Course overview -->
        <div class="net-card p-4 p-lg-5 mb-3">
          <div class="row g-4 align-items-center">
            <div class="col-lg-8">
              <h1 class="h3 mb-2">
                <span class="text-teal" id="courseHeroTitle">Course</span>
              </h1>

              <p id="courseDesc" class="text-muted mb-0">Loading description...</p>

              <!-- NEW (accessibility): quick actions are in a toolbar-like group -->
              <div class="d-flex flex-wrap gap-2 mt-3" role="group" aria-label="Course actions">
                <button class="btn btn-teal btn-sm" id="completeLessonBtn" aria-label="Complete current lesson and earn XP">
                  Complete Lesson (+XP)
                </button>

                <!-- NEW: Full quiz page button -->
                <button class="btn btn-outline-secondary btn-sm" id="openFullQuizBtn" aria-label="Open full quiz page for the current lesson">
                  Open Full Quiz
                </button>

                <!-- NOTE: renamed to avoid duplicate id -->
                <button class="btn btn-outline-secondary btn-sm" id="startChallengeBtnTop" aria-label="Start current lesson challenge">
                  Start Challenge
                </button>

                <a class="btn btn-outline-secondary btn-sm" href="sandbox.html" aria-label="Open sandbox page">
                  View Sandbox
                </a>
              </div>

              <!-- NEW: small helper text for readability -->
              <div class="small text-muted mt-3">
                Choose a unit on the left to view an overview, or open a lesson to start learning.
              </div>
            </div>

            <div class="col-lg-4">
              <div class="net-mini-media p-3" role="note" aria-label="Learning tip">
                <div class="small text-muted mb-1">Tip</div>
                <div class="fw-semibold mb-1">Learn → Quiz → Build</div>
                <div class="small text-muted">
                  Each lesson has a quick quiz and a sandbox challenge to earn XP.
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ===================================================== -->
        <!-- NEW: Unit View (Khan-style unit page) - ADDED ONLY     -->
        <!-- This is hidden by default. course.js will toggle it.  -->
        <!-- ===================================================== -->
        <div class="net-card p-4 p-lg-5 mb-3" id="unitView" style="display:none;" aria-label="Unit overview">
          <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-2">
            <div>
              <div class="small text-muted">Unit</div>
              <h2 class="h4 mb-0" id="unitTitle">Unit title...</h2>
            </div>

            <!-- NEW: Back to lesson button (works without extra JS) -->
            <!-- course.js will hide unit view when lesson view renders -->
            <button type="button"
                    class="btn btn-outline-secondary btn-sm"
                    onclick="(function(){ try{ __courseState.view='lesson'; renderCurrentLesson(); } catch(e){} })()"
                    aria-label="Go to current lesson">
              Go to current lesson →
            </button>
          </div>

          <div class="net-learn-box mb-3">
            <div class="fw-semibold mb-1">About this unit</div>
            <div class="text-muted" id="unitAbout">Unit about text...</div>
          </div>

          <!-- NEW: helper text -->
          <div class="small text-muted mb-3">
            Pick an item below to open the lesson view. Practice and quizzes will appear inside the lesson panel.
          </div>

          <div id="unitSections">
            <!-- course.js renders Khan-style section cards here -->
          </div>
        </div>
        <!-- ===================================================== -->
        <!-- END NEW UNIT VIEW                                     -->
        <!-- ===================================================== -->

        <!-- ===================================================== -->
        <!-- NEW: Lesson View Wrapper - ADDED ONLY                 -->
        <!-- Keeps all your existing lesson blocks intact          -->
        <!-- course.js will show/hide this when viewing units       -->
        <!-- ===================================================== -->
        <div id="lessonView" aria-label="Lesson view">

          <!-- Current Lesson -->
          <div class="net-card p-4 p-lg-4 mb-3">
            <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-2">
              <div>
                <div class="small text-muted">Current lesson</div>
                <div id="lessonTitle" class="h5 mb-0">Lesson title...</div>
              </div>

              <div class="d-flex flex-wrap align-items-center gap-2">
                <span id="lessonIndicator" class="badge text-bg-light border">Lesson 1 of 1</span>

                <!-- NEW: skip links for keyboard users -->
                <a class="btn btn-outline-secondary btn-sm"
                   href="#quizBox"
                   aria-label="Jump to quick quiz section">
                  Jump to Quiz
                </a>

                <button id="prevLessonBtn" class="btn btn-outline-secondary btn-sm" aria-label="Previous lesson">← Prev</button>
                <button id="nextLessonBtn" class="btn btn-outline-secondary btn-sm" aria-label="Next lesson">Next →</button>
              </div>
            </div>

            <div class="net-learn-box mt-3">
              <div class="fw-semibold mb-1">Learn</div>
              <div id="lessonContent" class="net-learn-text" aria-live="polite">
                Loading lesson content...
              </div>
            </div>
          </div>

          <div class="row g-3">
            <!-- Quiz -->
            <div class="col-lg-6">
              <div class="net-card p-4 h-100" aria-label="Quick quiz card">
                <div class="d-flex align-items-center justify-content-between mb-2">
                  <div class="fw-semibold">Quick Quiz</div>
                  <div class="small text-muted">Score: <span id="quizScore">0/1</span></div>
                </div>

                <div id="quizBox" class="d-grid gap-2" aria-label="Quiz options"></div>
                <div id="quizFeedback" class="small mt-2 text-muted" aria-live="polite"></div>

                <div class="small text-muted mt-3">
                  Correct answers give XP automatically.
                </div>

                <!-- OPTIONAL: also add a 2nd entry point for full quiz -->
                <div class="d-grid mt-3">
                  <button class="btn btn-teal" id="openFullQuizBtn2" aria-label="Open the full quiz page for this lesson">
                    Open Full Quiz →
                  </button>
                </div>
              </div>
            </div>

            <!-- Challenge -->
            <div class="col-lg-6">
              <div class="net-card p-4 h-100" aria-label="Sandbox challenge card">
                <div class="d-flex align-items-center justify-content-between mb-2">
                  <div class="fw-semibold">Sandbox Challenge</div>
                  <span class="badge bg-teal">Build</span>
                </div>

                <div id="challengeBox" class="mb-3" aria-live="polite">
                  <div class="text-muted small">Loading challenge...</div>
                </div>

                <div class="d-grid gap-2" role="group" aria-label="Challenge actions">
                  <button class="btn btn-teal" id="startChallengeBtn" aria-label="Open the current lesson challenge in sandbox">
                    Open Challenge in Sandbox
                  </button>
                  <button class="btn btn-outline-secondary" id="validateChallengeBtn" aria-label="Validate your sandbox challenge">
                    Validate in Sandbox
                  </button>
                </div>

                <div class="small text-muted mt-3">
                  Challenge validation + return flow is Part 3.
                </div>
              </div>
            </div>
          </div>

        </div>
        <!-- ===================================================== -->
        <!-- END NEW LESSON VIEW WRAPPER                            -->
        <!-- ===================================================== -->

      </section>
    </div>
  </main>

  <footer class="text-center border-top py-3 bg-white" role="contentinfo">
    <p class="small text-muted mb-0">2025 – Jamie O’Neill – TU857/4</p>
  </footer>

  <!-- IMPORTANT: course_content before course.js -->
  <script src="js/config.js"></script>
  <script src="js/course_content.js"></script>
  <script src="js/course.js"></script>

  <!-- Mirror title safely (no observer) -->
  <script>
    // Copy sidebar title into hero once after it appears
    setTimeout(() => {
      const t = document.getElementById("courseTitle");
      const hero = document.getElementById("courseHeroTitle");
      if (t && hero && t.textContent) hero.textContent = t.textContent;
    }, 300);
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
